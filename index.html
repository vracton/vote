<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>The True Question</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=IM+Fell+English&display=swap');

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'IM Fell English', serif;
      background: url('https://www.transparenttextures.com/patterns/old-paper.png'), #e8d7b4;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #46433A;
    }

    .container {
      background: url('https://www.transparenttextures.com/patterns/paper.png'), #f3ecd8;
      border-radius: 8px;
      padding: 40px;
      max-width: 500px;
      width: 90%;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      border: 1px solid #baa378;
    }

    h1 {
      color: #604020;
      margin-bottom: 30px;
      font-size: 2.5em;
      font-family: 'Playfair Display', serif;
      letter-spacing: 1px;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }

    .name-input {
      width: 100%;
      padding: 15px;
      border: 1px solid #baa378;
      background-color: #f9f4e8;
      border-radius: 4px;
      margin-bottom: 30px;
      font-size: 16px;
      box-sizing: border-box;
      font-family: 'IM Fell English', serif;
    }

    .vote-buttons {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .vote-btn {
      flex: 1;
      padding: 20px;
      border: 1px solid #8c6d3f;
      border-radius: 4px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      min-width: 200px;
      font-family: 'IM Fell English', serif;
      background: linear-gradient(to bottom, #e9dfc4 0%, #d5c59a 100%);
      color: #604020;
    }

    .vote-btn:hover {
      background: linear-gradient(to bottom, #e0d6bc 0%, #c9b98c 100%);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .option1 {
      border-color: #9a5c32;
    }

    .option2 {
      border-color: #4a7c6f;
    }

    .results {
      display: none;
    }

    .result-bar {
      margin: 15px 0;
      text-align: left;
    }

    .result-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
      font-weight: bold;
    }

    .bar {
      height: 30px;
      border-radius: 4px;
      position: relative;
      overflow: hidden;
      border: 1px solid #baa378;
    }

    .bar-fill {
      height: 100%;
      transition: width 0.5s ease;
    }

    .capsule-button {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #d5c59a;
      border: 1px solid #8c6d3f;
      padding: 12px 28px;
      border-radius: 4px;
      color: #604020;
      text-decoration: none;
      font-weight: bold;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transition: all 0.3s;
      font-family: 'IM Fell English', serif;
    }

    .capsule-button:hover {
      background: #c9b98c;
    }

    .loading {
      display: none;
      color: #604020;
    }

    @media (max-width: 600px) {
      .vote-buttons {
        flex-direction: column;
      }
      
      .vote-btn {
        min-width: auto;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Salutations.</h1>
    
    <div id="voting-form">
      <input type="text" id="nameInput" class="name-input" placeholder="Enter your name (optional)">
      
      <div class="vote-buttons">
        <button class="vote-btn option1" onclick="vote(true)">
          Skibidi Toilet
        </button>
        <button class="vote-btn option2" onclick="vote(false)">
          Tralalero Tralala
        </button>
      </div>
    </div>

    <div id="loading" class="loading">
      Submitting your vote...
    </div>

    <div id="results" class="results">
      <h2>Results</h2>
      <div class="result-bar">
        <div class="result-label">
          <span>Skibidi Toilet</span>
          <span id="option1-count">0 votes</span>
        </div>
        <div class="bar" style="background: #ffebee;">
          <div id="option1-bar" class="bar-fill" style="background: #ff6b6b; width: 0%;"></div>
        </div>
      </div>
      
      <div class="result-bar">
        <div class="result-label">
          <span>Tralalero Tralala</span>
          <span id="option2-count">0 votes</span>
        </div>
        <div class="bar" style="background: #e0f2f1;">
          <div id="option2-bar" class="bar-fill" style="background: #4ecdc4; width: 0%;"></div>
        </div>
      </div>
    </div>
  </div>

  <a class="capsule-button" href="https://vracto.xyz" target="_blank">
    visit vracto.xyz
  </a>

  <script>
    const API_BASE = 'https://sf8t9lphw1.execute-api.us-east-2.amazonaws.com';
    const POLL_NAME = 'brainrot';

    if (localStorage.getItem('voted-brainrot')) {
      loadResults();
    }

    async function vote(choseOption1) {
      const name = document.getElementById('nameInput').value;
      
      document.getElementById('voting-form').style.display = 'none';
      document.getElementById('loading').style.display = 'block';

      try {
        const response = await fetch(`${API_BASE}/vote/${POLL_NAME}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            name: name,
            choseOption1: choseOption1
          })
        });

        if (response.ok) {
          localStorage.setItem('voted-brainrot', 'true');
          
          await loadResults();
        } else {
          throw new Error('Failed to submit vote');
        }
      } catch (error) {
        console.error('Error submitting vote:', error);
        alert('Failed to submit vote. Please try again.');
        
        document.getElementById('voting-form').style.display = 'block';
        document.getElementById('loading').style.display = 'none';
      }
    }

    async function loadResults() {
      try {
        const response = await fetch(`${API_BASE}/getVotes/${POLL_NAME}`);
        const data = await response.json();

        const total = data.option1Count + data.option2Count;
        const option1Percent = total > 0 ? (data.option1Count / total) * 100 : 0;
        const option2Percent = total > 0 ? (data.option2Count / total) * 100 : 0;

        document.getElementById('option1-count').textContent = `${data.option1Count} votes`;
        document.getElementById('option2-count').textContent = `${data.option2Count} votes`;

        document.getElementById('option1-bar').style.width = `${option1Percent}%`;
        document.getElementById('option2-bar').style.width = `${option2Percent}%`;

        document.getElementById('loading').style.display = 'none';
        document.getElementById('voting-form').style.display = 'none';
        document.getElementById('results').style.display = 'block';

      } catch (error) {
        console.error('Error loading results:', error);
        document.getElementById('loading').textContent = 'Failed to load results';
      }
    }
  </script>
</body>
</html>
